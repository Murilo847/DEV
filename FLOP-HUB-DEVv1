-- [LUA NEXUS] | LOADER SYSTEM V56
-- Versao Final (Links Dinamicos + Auto Update)

local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local MarketplaceService = game:GetService("MarketplaceService")
local LocalPlayer = Players.LocalPlayer

-- ====================================================
-- CONFIGURACOES (LINKS PERMANENTES - NAO PRECISA MAIS MUDAR)
-- ====================================================
-- Link das Keys (Sempre pega a ultima versao editada)
local UrlKeys = "https://gist.githubusercontent.com/Murilo847/fe4faa75154c36319ed229fce3225666/raw/keys-loader-marvel-omega.txt"

-- Link do Script (Sempre pega a ultima versao editada)
local UrlScript = "https://gist.githubusercontent.com/Murilo847/b88ddb99acfc2631e0f31736a2dcebe0/raw/FLOP-HUB-MARVEL-OMEGAV3-CONFIG.txt"

local WebhookURL = "https://discord.com/api/webhooks/1459888505252745607/jZGBnAX_Aio-Zdd77Fhv4Wcsf5yiL_KYRj7d_e0my5p8pU7oL-YU1Qngh0fQhjNSEZvU" 
local FileName = "NexusLoader_Key.txt"
-- ====================================================

-- LOGGER SYSTEM
local function LogarExecucao(keyUsada)
    if WebhookURL == "" or WebhookURL:find("COLOQUE") then return end

    local executor = identifyexecutor and identifyexecutor() or "Desconhecido"
    
    local success, gameInfo = pcall(function()
        return MarketplaceService:GetProductInfo(game.PlaceId)
    end)
    local nomeDoJogo = success and gameInfo.Name or "Jogo Desconhecido (ID: " .. game.PlaceId .. ")"

    local data = {
        ["username"] = "Nexus Logger",
        ["avatar_url"] = "https://cdn.discordapp.com/embed/avatars/0.png",
        ["embeds"] = {{
            ["title"] = "Acesso Liberado",
            ["description"] = "Um usuario passou pela verificacao.",
            ["color"] = 65535,
            ["fields"] = {
                { ["name"] = "Usuario", ["value"] = LocalPlayer.DisplayName .. " (" .. LocalPlayer.Name .. ")", ["inline"] = true },
                { ["name"] = "Key Usada", ["value"] = "||" .. keyUsada .. "||", ["inline"] = true },
                { ["name"] = "Executor", ["value"] = executor, ["inline"] = true },
                { ["name"] = "Jogo", ["value"] = nomeDoJogo, ["inline"] = true }
            },
            ["footer"] = { ["text"] = "Nexus System - " .. os.date("%d/%m/%Y - %X") }
        }}
    }

    local jsonData = HttpService:JSONEncode(data)
    local httpRequest = (syn and syn.request) or (http and http.request) or http_request or (fluxus and fluxus.request) or request

    if httpRequest then
        httpRequest({
            Url = WebhookURL, 
            Body = jsonData, 
            Method = "POST", 
            Headers = {["Content-Type"] = "application/json"}
        })
    end
end

-- PALETA DE CORES
local ColorGlassDark = Color3.fromRGB(10, 10, 15) 
local ColorGlassLight = Color3.fromRGB(30, 30, 40) 
local ColorStroke = Color3.fromRGB(60, 60, 80) 
local ColorGreen = Color3.fromRGB(100, 255, 120) 
local ColorRed = Color3.fromRGB(255, 80, 80)
local ColorWhite = Color3.new(1, 1, 1)
local ColorTextDim = Color3.fromRGB(160, 160, 180)

-- HELPERS
local function AddCorner(parent, radius) 
    local c = Instance.new("UICorner", parent)
    c.CornerRadius = UDim.new(0, radius)
    return c 
end

local function AddStroke(parent, color, thickness) 
    local s = Instance.new("UIStroke", parent)
    s.Color = color or ColorStroke
    s.Thickness = thickness or 1.2
    s.Transparency = 0.5
    s.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    return s 
end

-- CONSTROI A UI
local ScreenGui = Instance.new("ScreenGui")
if CoreGui:FindFirstChild("NexusLoader") then CoreGui.NexusLoader:Destroy() end
ScreenGui.Parent = CoreGui
ScreenGui.Name = "NexusLoader"
ScreenGui.IgnoreGuiInset = true
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local Frame = Instance.new("Frame", ScreenGui)
Frame.Name = "MainFrame"
Frame.Size = UDim2.new(0, 350, 0, 180)
Frame.Position = UDim2.new(0.5, -175, 0.5, -90)
Frame.BackgroundColor3 = ColorGlassDark
Frame.BackgroundTransparency = 0.25
Frame.BorderSizePixel = 0
AddCorner(Frame, 20)
AddStroke(Frame, ColorStroke, 1.5)

local HeaderPatch = Instance.new("Frame", Frame)
HeaderPatch.BackgroundColor3 = ColorGlassLight
HeaderPatch.BackgroundTransparency = 0.3
HeaderPatch.Size = UDim2.new(1, 0, 0, 45)
AddCorner(HeaderPatch, 20)

local FixCorner = Instance.new("Frame", HeaderPatch)
FixCorner.Size = UDim2.new(1, 0, 0, 10)
FixCorner.Position = UDim2.new(0, 0, 1, -10)
FixCorner.BackgroundColor3 = ColorGlassLight
FixCorner.BackgroundTransparency = 1
FixCorner.BorderSizePixel = 0

local Title = Instance.new("TextLabel", Frame)
Title.Text = "FLOP HUB | LOADER"
Title.Size = UDim2.new(1, 0, 0, 45)
Title.TextColor3 = ColorWhite
Title.BackgroundTransparency = 1
Title.Font = Enum.Font.GothamBlack
Title.TextSize = 16
Title.ZIndex = 2

local StatusDot = Instance.new("Frame", Frame)
StatusDot.BackgroundColor3 = ColorRed 
StatusDot.Size = UDim2.new(0, 12, 0, 12)
StatusDot.Position = UDim2.new(1, -30, 0, 16)
StatusDot.ZIndex = 3
AddCorner(StatusDot, 100)
AddStroke(StatusDot, ColorWhite, 1)

local InputContainer = Instance.new("Frame", Frame)
InputContainer.BackgroundColor3 = ColorGlassLight
InputContainer.BackgroundTransparency = 0.5
InputContainer.Size = UDim2.new(0.85, 0, 0, 45)
InputContainer.Position = UDim2.new(0.075, 0, 0.35, 0)
AddCorner(InputContainer, 12)
AddStroke(InputContainer, ColorStroke, 1)

local KeyBox = Instance.new("TextBox", InputContainer)
KeyBox.Size = UDim2.new(1, -20, 1, 0)
KeyBox.Position = UDim2.new(0, 10, 0, 0)
KeyBox.PlaceholderText = "Cole sua Key aqui..."
KeyBox.Text = ""
KeyBox.BackgroundTransparency = 1
KeyBox.TextColor3 = ColorWhite
KeyBox.PlaceholderColor3 = ColorTextDim
KeyBox.Font = Enum.Font.GothamBold
KeyBox.TextSize = 14
KeyBox.TextXAlignment = Enum.TextXAlignment.Center

-- AUTO-FILL (CARREGA A KEY SALVA)
if isfile and isfile(FileName) then
    local savedKey = readfile(FileName)
    if savedKey and savedKey ~= "" then
        KeyBox.Text = savedKey
    end
end

local Btn = Instance.new("TextButton", Frame)
Btn.Size = UDim2.new(0.6, 0, 0, 40)
Btn.Position = UDim2.new(0.2, 0, 0.7, 0)
Btn.Text = "ENTRAR"
Btn.BackgroundColor3 = ColorGlassLight
Btn.BackgroundTransparency = 0.3
Btn.TextColor3 = ColorWhite
Btn.Font = Enum.Font.GothamBlack
Btn.TextSize = 14
Btn.AutoButtonColor = true
AddCorner(Btn, 12)
AddStroke(Btn, ColorStroke, 1)

-- LOGICA DE CLIQUE
Btn.MouseButton1Click:Connect(function()
    Btn.Text = "VERIFICANDO..."
    StatusDot.BackgroundColor3 = Color3.fromRGB(255, 255, 0) 
    task.wait(0.5)
    
    local success, keyListRaw = pcall(function()
        return game:HttpGet(UrlKeys)
    end)
    
    if success then
        local inputKey = KeyBox.Text:gsub("%s+", "")
        local isValid = false
        
        for line in keyListRaw:gmatch("[^\r\n]+") do
            local cleanLine = line:gsub("%s+", "")
            if cleanLine == inputKey and inputKey ~= "" then
                isValid = true
                break 
            end
        end
        
        if isValid then
            -- [SUCESSO]
            
            -- SALVA A KEY NO ARQUIVO
            if writefile then
                writefile(FileName, inputKey)
            end

            task.spawn(function()
                LogarExecucao(inputKey)
            end)

            Btn.Text = "KEY APROVADA"
            Btn.TextColor3 = ColorGreen
            StatusDot.BackgroundColor3 = ColorGreen
            
            local Tween = TweenService:Create(Btn, TweenInfo.new(0.3), {BackgroundColor3 = ColorGreen, BackgroundTransparency = 0.5})
            Tween:Play()
            Btn.TextColor3 = ColorWhite
            
            task.wait(1)
            ScreenGui:Destroy()
            
            -- CARREGA O SCRIPT PRINCIPAL
            loadstring(game:HttpGet(UrlScript))()
            
            game:GetService("StarterGui"):SetCore("SendNotification", {
                Title = "FLOP HUB",
                Text = "ACESSO LIBERADO",
                Duration = 5,
            })
        else
            -- [FALHA]
            Btn.Text = "KEY INVALIDA"
            Btn.TextColor3 = ColorRed
            StatusDot.BackgroundColor3 = ColorRed
            
            local Tween = TweenService:Create(Btn, TweenInfo.new(0.3), {BackgroundColor3 = ColorRed, BackgroundTransparency = 0.5})
            Tween:Play()
            Btn.TextColor3 = ColorWhite
            
            task.wait(1.5)
            
            Btn.Text = "ENTRAR"
            Btn.BackgroundColor3 = ColorGlassLight
            Btn.BackgroundTransparency = 0.3
            Btn.TextColor3 = ColorWhite
        end
    else
        Btn.Text = "ERRO HTTP"
        Btn.TextColor3 = ColorRed
        print("Erro ao conectar no Github das Keys")
    end
end)

-- LOGICA DE ARRASTAR JANELA
local dragging, dragInput, dragStart, startPos
Frame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = Frame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then dragging = false end
        end)
    end
end)
Frame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)
UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        Frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)
